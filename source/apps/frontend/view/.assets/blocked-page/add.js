(()=>{var e=[".csv"],t="/blocked-page/importCSV",n=15728640;function a(){$(".item_selected").length>0?$(".btn-clear-target").removeClass("d-none"):$(".btn-clear-target").addClass("d-none")}function r(e,a){var r=new FormData,s=e.target.files[0];if(s.size>n)return new AlertError("You uploaded file over 15mb, please choose another file!"),void $("#loading_csv").addClass("d-none");r.append("file",s),$.ajax({url:t,type:"POST",contentType:!1,processData:!1,data:r,beforeSend:function(e){},error:function(e,t){var n=AjaxErrorMessage(e,t);new AlertError("AJAX ERROR: "+n),$("#loading_csv").addClass("d-none")},success:function(e){$("#loading_csv").addClass("d-none")},complete:function(e){$("#loading_csv").addClass("d-none"),function(e,t){switch(e.status){case"error":1===e.errors.length&&""===e.errors[0].id?new AlertError(e.errors[0].message):e.errors.length>0?($.each(e.errors,(function(e,t){$("#"+t.id).addClass("is-invalid").nextAll("span.invalid-feedback").text(t.message)})),new AlertError(e.errors[0].message)):new AlertError("Error!");break;case"success":var n=[];$.each(e.data_object,(function(e,t){n.push(t.issue_location)})),i(n),NoticeSuccess("Import .csv success!")}}(e.responseJSON)}}),a.nextAll(".form-control").val(s.name)}function s(e,t){switch(e.status){case"error":1===e.errors.length&&""===e.errors[0].id?new AlertError(e.errors[0].message):e.errors.length>0?($.each(e.errors,(function(e,t){$("#"+t.id).addClass("is-invalid").nextAll("span.invalid-feedback").text(t.message)})),$("#"+e.errors[0].id).focus(),$("#"+e.errors[0].id).prev("label").focus()):new AlertError("Error!");break;case"success":NoticeSuccess("Blocked has been created successfully"),setTimeout((function(){window.location.replace("/rule")}),1e3);break;default:new AlertError("Undefined")}}function i(e){var t=[],n=",";if(e)t=e;else{var a=$("#input-page").val();if(!a.trim())return!0;-1!==a.trim().indexOf("\n")?(t=a.trim().split("\n"),n="\n"):-1!==a.trim().indexOf(",")?(t=a.trim().split(","),n=","):t.push(a.trim())}var r=!0,s=0,i="",o=[];return t.length>0&&t.forEach((function(e){if(""!==(e=e.replace(/(^\w+:|^)\/\//,""))){var t=!0;$(".box-page-selected").find(".item_selected").length&&$(".box-page-selected").find(".item_selected").each((function(){e.trim()===$(this).find(".btn-remove").attr("data-name").trim()&&(t=!1)})),n=e,new RegExp("((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(n)||(t=!1,o.push(e)),t&&function(e,t){e=e.replace(/(^\w+:|^)\/\//,""),t.append('\n    <div class="d-flex flex-row align-items-center p-2 border-bottom target-item item_selected">\n        <div class="col p-0" style="width: 97%">\n            <span class="m-0" style="overflow-wrap: break-word;font-size: 14px">'.concat(e,'</span>\n        </div>\n        <div class="col-auto px-0">\n            <button type="button" data-name="').concat(e,'" style="width: 16px; height: 16px"\n                    class="btn d-flex align-items-center btn-outline-danger btn-icon rounded-circle p-0 btn-remove">\n                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-dash-lg"\n                     viewBox="0 0 16 16">\n                    <path d="M0 8a1 1 0 0 1 1-1h14a1 1 0 1 1 0 2H1a1 1 0 0 1-1-1z"></path>\n                </svg>\n            </button>\n        </div>\n    </div>                                           \n    '))}(e,$(".box-page-selected"))}var n})),o.length>0&&(r=!1,o.forEach((function(e){""!==(e=e.replace(/\s+/g,""))&&(0===s?(e,i=e):i+=n+e,s++),NoticeError(e+" fail")}))),$("#input-page").val(i),r}$(document).ready((function(){$("#upload_csv").on("change",(function(t){$("#loading_csv").removeClass("d-none"),function(e,t,n){var s=e[0];if("file"===s.type){var i=s.value;if(i.length>0){for(var o=!1,l=0;l<t.length;l++){var d=t[l];if(i.substr(i.length-d.length,d.length).toLowerCase()===d.toLowerCase()){o=!0,r(n,e);break}}if(!o)return $("#loading_csv").addClass("d-none"),new AlertError("Sorry, "+i+" is invalid, allowed extensions are: "+t.join(", ")),!1}else $("#loading_csv").addClass("d-none")}a()}($(this),e,t)})),$(".box-page-selected").on("click",".target-item .btn-remove",(function(e){$(this).closest(".target-item").remove(),a()})),$(".remove_all").on("click",(function(){$(".box-page-selected").html(""),a()})),$("#input-page").on("keypress",(function(e){13===(e.keyCode||e.which)&&(e.preventDefault(),i(),a())})),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=$("#"+e);function r(){if(!1===i())return AlertError("Please check the page list again!"),void $("#input-page").focus();var e=$(".submit"),r=e.text(),s="Loading...",o=a.serializeObject(),l=[];$(".box-page-selected").find(".item_selected").length&&$(".box-page-selected").find(".item_selected").each((function(){l.push($(this).find(".btn-remove").attr("data-name").trim())})),o.pages=l,o.id=parseInt(o.id),$.ajax({url:n,type:"POST",dataType:"JSON",contentType:"application/json",data:JSON.stringify(o),beforeSend:function(t){e.attr("disabled",!0).text(s)},error:function(t,n){var a=AjaxErrorMessage(t,n);new AlertError("AJAX ERROR: "+a),e.attr("disabled",!1).text(r)},success:function(t){e.attr("disabled",!1).text(r)},complete:function(e){t(e.responseJSON,a)}})}a.find("input").on("input",(function(e){var t=$(this);t.hasClass("is-invalid")&&t.removeClass("is-invalid").next(".invalid-feedback").empty(),t.closest("#box-upload-csv").hasClass("is-invalid")&&t.closest("#box-upload-csv").removeClass("is-invalid").next(".invalid-feedback").empty()})),a.find("textarea").on("input",(function(e){var t=$(this);t.hasClass("is-invalid")&&t.removeClass("is-invalid").next(".invalid-feedback").empty(),t.hasClass("textarea-add-custom")?($(".notify-domain-err").addClass("invalid-feedback"),$(".domain-err").empty()):($(".notify-creative-err").addClass("invalid-feedback"),$(".creative-err").empty())})),a.on("keypress","input",(function(e){var t=!1;t=$(this).data("no-submit"),13!==(e.keyCode||e.which)||t||(e.preventDefault(),r())})),a.find(".submit").on("click",(function(e){e.preventDefault(),r()}))}("formBlockedPage",s)}))})();