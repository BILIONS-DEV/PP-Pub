(()=>{var t="#formFilterHistory",e="/history/";[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map((function(t){return new bootstrap.Tooltip(t)}));function a(t){$(".result-history-item").find(".table-history tbody").css("opacity","0"),$.ajax({url:e+t,type:"POST",dataType:"JSON",contentType:"application/json; charset=utf-8"}).done((function(t){var e,a,s;1==t.status&&($(".result-history-item").html((e=t.data.Compare,a=t.data.Row,s=t.data.CreateTime,'<div class="modal-header border-0 pb-0 align-items-start px-4">    <h5 class="modal-title text-white" id="exampleModalLabel">History: '+a.ObjectName+" "+a.Title+'</h5>    </button></div><div class="modal-body p-4 pb-0">    <div class="header-history">        <div class="header-h">            <span class="pr-2">Show</span> <span class="">                <label class="" for="is_default"> </label>                <div class="form-check form-check-inline form-check-rounded">                    <label for="Everything">                        Everything                    </label>                    <input class="form-check-input loadType" type="radio" value="Everything" name="loadType" id="Everything">                </div>            </span> <span class="">                <label class="" for="is_default"> </label>                <div class="form-check form-check-inline form-check-rounded">                    <label for="ChangesOnly">                        Changes only                    </label>                    <input class="form-check-input loadType" type="radio" value="ChangesOnly" name="loadType" checked id="ChangesOnly">                </div>            </span>        </div>    </div>    <div class="table-responsive" style="overflow: auto;">        <table class="table table-hover table-striped border-0 mb-0 table-history">            <thead>            <tr>                <th scope="col" style=" min-width: 300px;">Field</th>                <th scope="col"></th>                <th scope="col" style="min-width: 120px;">Previous state</th>                <th scope="col">Current state</th>            </tr>            </thead>            <tbody>                <tr class="item-'+a.ID+' title-item">                    <td colspan="4"><b>'+a.Title+" on "+s+"</b></td>                </tr>  "+function(t,e){if(0==t.length)return"";var a="";return t.forEach((function(t,s){var o="";"none"==t.Action&&(o="everything");var i="";switch(t.Action){case"add":i='<span data-bs-toggle="tooltip" data-bs-placement="left" title="Add">                   <i class="fa fa-plus-circle text-success " aria-hidden="true"></i>              </span>';break;case"update":i='<span data-bs-toggle="tooltip" data-bs-placement="left" title="Update">                   <i class="fa fa-refresh" aria-hidden="true"></i>              </span>';break;case"delete":i='<span data-bs-toggle="tooltip" data-bs-placement="left" title="Delete">                   <i class="fa fa-minus-circle text-danger" aria-hidden="true"></i>              </span>';break;default:i='<i class="fa fa-circle-o" aria-hidden="true" style="opacity: 0.3;"></i>'}var l="";l=""==t.OldData?'<span class="opacity-50">N/A</span>':htmlEntities(t.OldData);var r="";r=""==t.NewData?'<span class="opacity-50">N/A</span>':htmlEntities(t.NewData),a=a+'<tr class="value-item '+o+" value-"+e.ID+'" data-id="'+e.ID+'">      <td class="text-nowrap">'+t.Text+"</td>      <td>"+i+"</td>      <td>"+l+"</td>    <td>"+r+"</td></tr>  "})),a}(e,a)+"          </tbody>        </table>    </div>    </div>")),checkTypeHistory($(".result-history-item"),"on",!0),$('[data-bs-toggle="tooltip"]').tooltip(),$(".pubpower-main").find(".table-responsive").css("max-height",screen.height-600+"px"))}))}function s(){var s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=$(t),i=(o.find(".submit").text(),o.serializeObject());i.page=parseInt(i.page)+1,i.start_date=$("#input_start_date").val(),i.end_date=$("#input_end_date").val(),$.ajax({url:e,type:"POST",dataType:"JSON",contentType:"application/json; charset=utf-8",data:JSON.stringify(i),beforeSend:function(t){},error:function(t,e){var a=AjaxErrorMessage(t,e);new AlertError("AJAX ERROR: "+a)}}).done((function(e){switch(e.status){case!0:if(e.data.records.length>0){i.page<2&&$(".list-history").html("");var o="";e.data.records.forEach((function(t,e){o!=new Date(t.CreatedAt).toLocaleDateString("en-us",{weekday:"long",year:"numeric",month:"short",day:"numeric"})&&(o=new Date(t.CreatedAt).toLocaleDateString("en-us",{weekday:"long",year:"numeric",month:"short",day:"numeric"}),$(".list-history").append('<div class="list-group-item px-md-4 border-right" data-id="2117"><div class="row"> <div class="col-auto"><span class="font-weight-bolt" data-bs-toggle="tooltip" data-bs-placement="left" title="" data-bs-original-title="Add" aria-label="Add" style="font-weight: 700;">'+o+"\n</span></div>   </div></div>")),$(".list-history").append(function(t){var e=new Date(t.CreatedAt),a="";a=1==t.ObjectType?'<span data-bs-toggle="tooltip" data-bs-placement="left" title="Add"><i class="fa fa-plus-circle text-success " aria-hidden="true"></i></span>':2==t.ObjectType?'<span data-bs-toggle="tooltip" data-bs-placement="left" title="Update"><i class="fa fa-refresh" aria-hidden="true"></i></span>':3==t.ObjectType?'<span data-bs-toggle="tooltip" data-bs-placement="left" title="Delete"><i class="fa fa-minus-circle text-danger" aria-hidden="true"></i></span>':'<i class="fa fa-circle-o" aria-hidden="true" style="opacity: 0.3;"></i>';return'<div class="list-group-item px-md-4 border-right" data-id="'+t.ID+'"><div class="row px-3"> <div class="col-auto">'+a+'</div>   <div class="col ps-0">   <span class="mb-2 d-block text-gray-800 load-history" role="button">'+t.ObjectName+" "+t.Title+'</span><p class="card-text text-gray-600 lh-sm">'+e+"</p></div></div></div>"}(t)),console.log(s),s&&(a(t.ID),s=!1)}))}else $(".list-history").html('<div class="list-group-item px-md-4" data-id="">                        <div class="row px-3">                           No Activity                       </div>                   </div>');e.data.totalRecord<=30*i.page?$(".load-more").closest("div").addClass("d-none"):$(".load-more").closest("div").removeClass("d-none"),$('[data-bs-toggle="tooltip"]').tooltip();break;case!1:e.errors.length>0&&e.errors.forEach((function(t,e){$(".list-history").html("").append('<div class="list-group-item px-md-4" data-id="">                        <div class="row px-3">'+t.message+"                       </div>                   </div>")}));break;case"error":console.log(e)}$(".load-more").text("Load more"),$(t).find(".submit").text("Run")}))}$(document).ready((function(){$(".list-history").css("max-height",screen.height-650+"px");var e=moment().subtract(100,"days"),o=moment().subtract(0,"days");$("#date_filter").daterangepicker({opens:"left",ranges:{Default:[moment().subtract(13,"days"),moment()],Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 days":[moment().subtract(7,"days"),moment().subtract(1,"days")],"Last 30 days":[moment().subtract(30,"days"),moment().subtract(1,"days")],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"All Time":[moment.unix(1611196933),moment()]},autoUpdateInput:!0,alwaysShowCalendars:!0,autoApply:!1,startDate:e,endDate:o},(function(t,e,a){!function(t,e,a){$("#input_start_date").val(t.format("YYYY-MM-DD")),$("#input_end_date").val(e.format("YYYY-MM-DD")),"Today"==a||"Yesterday"==a?$(".result-search-time").text(t.format("MMM D, YYYY")):"All Time"==a?$(".result-search-time").text(a):$(".result-search-time").text(t.format("MMM D, YYYY")+" - "+e.format("MMM D, YYYY"));s()}(t,e,a)})),$(t).find(".submit").on("click",(function(t){$(this).text("Loading..."),t.preventDefault(),$("#page").val(0),s()})),$(".load-more").on("click",(function(t){$(this).text("Loading..."),t.preventDefault(),$("#page").val(parseInt($("#page").val())+1),s(!1)})),s(),$(".list-history").on("click",".load-history",(function(){a($(this).closest(".list-group-item").attr("data-id"))})),$("#object_page").change((function(){var t=$(this).val();t||$(".filter_objectId").addClass("d-none"),$.ajax({type:"POST",url:"/history/object-by-page/",data:{object_page:t}}).done((function(e){"success"==e.status&&(e.data&&e.data.length>0?($("#object_id").find("option").remove(),$("#object_id").append('<option value="">All</option>'),e.data.forEach((function(t,e){console.log(t);var a='<option value="'+t.ID+'" >'+t.Name+"</option>";$("#object_id").append(a),$("#object_id").selectpicker("refresh"),$(".filter_objectId").removeClass("d-none")}))):$(".filter_objectId").addClass("d-none")),"error"==e.status&&new AlertError(e.message),$(".filter_objectId .filter-option-inner-inner").text("All "+t)}))})),$(".result-history-item").on("change",".loadType",(function(){checkTypeHistory($(".result-history-item"),"on")}))}))})();