(()=>{function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,a){if(!e)return;if("string"==typeof e)return t(e,a);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return t(e,a)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}var a={inventory:[],format:[],size:[]},i={idSelect:"#list_inventory",idBox:".box_inventory",idIsMoreData:"#is_more_inventory",isMoreData:!0,lastPage:!1,page:1,isSearch:!1,search:"",idSearch:"#search_inventory",urlAjax:"/target/loadInventory",optionAjax:"domain",filterAjax:[],list_selected:[],btnInclude:"add_inventory",btnRemove:"remove_inventory",idEmpty:"empty_ad_domain",idEmptyLoad:"load_empty_domain",checkLoadMore:!1,text:"#text_for_domain",btnRemoveAll:"remove_all_domain",btnSelectAll:"select_all_domain",block:".block_domain",container:".container_domain",boxEmpty:"box_empty_domain"},n={idSelect:"#list_ad_tag",idBox:".box_ad_tag",idIsMoreData:"#is_more_tag",isMoreData:!0,lastPage:!1,page:1,isSearch:!1,search:"",idSearch:"#search_ad_tag",urlAjax:"/target/loadInventory",optionAjax:"adtag",filterAjax:[],list_selected:[],btnInclude:"add_tag",btnRemove:"remove_tag",idEmpty:"empty_ad_tag",idEmptyLoad:"load_empty_ad_tag",checkLoadMore:!1,text:"#text_for_tag",btnRemoveAll:"remove_all_tag",btnSelectAll:"select_all_tag",block:".block_tag",container:".container_tag",boxEmpty:"box_empty_tag"},o={idSelect:"#list_ad_format",idBox:".box_ad_format",idIsMoreData:"#is_more_adformat",isMoreData:!0,lastPage:!1,page:1,isSearch:!1,search:"",idSearch:"#search_ad_format",urlAjax:"/target/loadInventory",optionAjax:"adformat",filterAjax:[],list_selected:[],btnInclude:"add_format",btnRemove:"remove_adFormat",idEmpty:"empty_ad_format",text:"#text_for_format",btnRemoveAll:"remove_all_format",btnSelectAll:"select_all_format",block:".block_format",container:".container_format",boxEmpty:"box_empty_format"},s={idSelect:"#list_ad_size",idBox:".box_ad_size",idIsMoreData:"#is_more_adsize",isMoreData:!0,lastPage:!1,page:1,isSearch:!1,search:"",idSearch:"#search_ad_size",urlAjax:"/target/loadInventory",optionAjax:"adsize",filterAjax:[],list_selected:[],btnInclude:"add_size",btnRemove:"remove_adSize",idEmpty:"empty_ad_size",idEmptyLoad:"load_empty_ad_size",checkLoadMore:!1,text:"#text_for_size",btnRemoveAll:"remove_all_size",btnSelectAll:"select_all_size",block:".block_size",container:".container_size",boxEmpty:"box_empty_size"},r={idSelect:"#list_geography",idBox:".box_geography",idIsMoreData:"#is_more_geography",isMoreData:!0,lastPage:!1,page:1,isSearch:!1,search:"",idSearch:"#search_geography",urlAjax:"/target/loadInventory",optionAjax:"geography",list_selected:[],btnInclude:"add_country",btnRemove:"remove_Geo",idEmpty:"empty_ad_geo",idEmptyLoad:"load_empty_geo",checkLoadMore:!1,text:"#text_for_geo",btnRemoveAll:"remove_all_geo",btnSelectAll:"select_all_geo",block:".block_geo",container:".container_geo",boxEmpty:"box_empty_geo"},l={idSelect:"#list_device",idBox:".box_device",idIsMoreData:"#is_more_device",isMoreData:!0,lastPage:!1,page:1,isSearch:!1,search:"",idSearch:"#search_device",urlAjax:"/target/loadInventory",optionAjax:"device",list_selected:[],list_original:[],btnInclude:"add_device",btnRemove:"remove_device",idEmpty:"empty_ad_device",idEmptyLoad:"load_empty_device",checkLoadMore:!1,text:"#text_for_device",btnRemoveAll:"remove_all_device",btnSelectAll:"select_all_device",block:".block_device",container:".container_device",boxEmpty:"box_empty_device"},d=[],c=[];function m(e,t,a){$.ajax({url:"/supply/loadParam",type:"GET",data:{id:e,name:t,index:a},success:function(e){$("#module-params").prepend(e.data),p()},error:function(e){console.log(e)}})}function p(){$("#select-module option").prop("selected",!1).trigger("change"),$("#select-module").selectpicker("refresh")}function u(){return c=[],$("#module-params > div.module_param_box").each((function(){if("criteo"===$(this).find(".bidder-box").attr("data-name")){var t=$(this).find(".bidder-box").attr("data-id"),a={};a.id=parseInt(t),a.name=$(this).find(".bidder-box").attr("data-name"),a.storage=[],a.params=[],c.push(a)}else $("input",this).each((function(){var t={},a=$(this).attr("data-option");t.type=$(this).attr("data-type"),t.name=$(this).attr("data-name"),t.template=this.value.trim();var i={storage:[],params:[],ab_testing:0,volume:0},n=parseInt($(this).attr("data-id")),o=c.map((function(e){return e.id})).indexOf(n);if(-1===o){switch(i.id=n,i.name=$(this).attr("data-module-name"),a){case"storage":i.storage=[t].concat(e(i.storage));break;case"params":i.params=[t].concat(e(i.params));break;case"ab_testing":this.checked?i.ab_testing=1:i.ab_testing=2;break;case"volume":i.volume=parseInt(this.value)}c.push(i)}else switch(a){case"storage":c[o].storage.push(t);break;case"params":c[o].params.push(t);break;case"ab_testing":this.checked?c[o].ab_testing=1:c[o].ab_testing=2;break;case"volume":c[o].volume=parseInt(this.value)}}))})),Object.values(c)}function v(e,t){switch(e.status){case"error":1===e.errors.length&&""===e.errors[0].id?new AlertError(e.errors[0].message):e.errors.length>0?($.each(e.errors,(function(e,t){var a=$("#"+t.id);if(a.addClass("is-invalid").nextAll("span.invalid-feedback").text(t.message),a.next().find(".select2-selection").addClass("select2-is-invalid"),a.closest(".box-select2").addClass("is-invalid").nextAll("span.invalid-feedback").text(t.message),"text_for_domain"===t.id){var i=t.message;a.html('<small class="text-danger">'.concat(i,"</small>")),$(".domain-card").addClass("domain-card-invalid")}if("text_for_domain"===t.id){$("#tab-target").click();var n=t.message;a.html('<small class="text-danger">'.concat(n,"</small>")),$(".domain-card").addClass("domain-card-invalid"),$("#collapseDomains").collapse("show"),$('div[href="#collapseDomains"]').addClass("dm14")}NoticeError(t.message)})),$("#"+e.errors[0].id).focus(),$("#"+e.errors[0].id).prev("label").focus()):new AlertError("Error!");break;case"success":NoticeSuccess("Identity has been created successfully"),setTimeout((function(){window.location.replace("/identity")}),1e3);break;default:new AlertError("Undefined")}}function f(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=$("#"+e),o=n.find(".submit"),s=o.text(),r="Loading...";function l(){d()}function d(){var e=n.serializeObject();e.listInventory=i.list_selected,e.priority=parseInt(e.priority),e.sync_delay=parseInt(e.sync_delay),e.auction_delay=parseInt(e.auction_delay),"on"===e.status?e.status=1:e.status=2,e.module_params=u();var o=JSON.stringify(e),l=$(".submit");$.ajax({url:a,type:"POST",dataType:"JSON",contentType:"application/json",data:o,beforeSend:function(e){l.attr("disabled",!0).text(r)},error:function(e,t){var a=AjaxErrorMessage(e,t);new AlertError("AJAX ERROR: "+a),l.attr("disabled",!1).text(s)},success:function(e){l.attr("disabled",!1).text(s)},complete:function(e){t(e.responseJSON,n)}})}n.find(".select2").on("select2:open",(function(e){var t=$(this);t.next().find(".select2-selection").hasClass("select2-is-invalid")&&(t.next().find(".select2-selection").removeClass("select2-is-invalid"),t.removeClass("is-invalid").next(".invalid-feedback").empty(),t.closest(".box-select2").next(".invalid-feedback").empty())})),n.find("input").on("input",(function(e){var t=$(this);t.hasClass("is-invalid")&&t.removeClass("is-invalid").next(".invalid-feedback").empty()})),$("#module-params").on("input",".module_param_box .param_value",(function(e){var t=$(this);t.hasClass("is-invalid")&&t.removeClass("is-invalid").next(".invalid-feedback").empty()})),n.find("textarea").on("input",(function(e){var t=$(this);t.hasClass("is-invalid")&&t.removeClass("is-invalid").next(".invalid-feedback").empty()})),$(n).on("keypress","input",(function(e){13===(e.keyCode||e.which)&&(e.preventDefault(),l())})),n.find(".submit").on("click",(function(e){e.preventDefault(),$.each(n.find("input.is-invalid"),(function(){$(this).removeClass("is-invalid").next(".invalid-feedback").empty()})),l()}))}function h(e){if(0===e.list_selected.length)$(e.idBox).html(""),$(e.idBox).append('<div id="'.concat(e.idEmpty,'" class="d-flex flex-row align-items-center px-md-2" style="height: 25px">\n            <div class="col p-0"><h6\n                        class="m-0 font-weight-semibold fs-12 text-center">\n                    No data selected</h6></div>\n        </div>'));else{$("."+e.btnRemoveAll).attr("hidden",!1);var t="#"+e.idEmpty;$(t).remove()}}function _(e){$(e.idSelect).on("scroll",(function(){var t=$(this).get(0),a=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e+t+1>=a}(Math.round(t.scrollTop),t.clientHeight,t.scrollHeight);a&&e.isMoreData&&(e.search=$(e.idSearch).val(),e.isSearch=!1,e.checkLoadMore||x(e))}))}function g(e){var t=$(e.idSelect).find("div.target-item"),a=$("."+e.boxEmpty);t.length>0?a.length>0&&a.attr("hidden",!0):a.length>0?a.attr("hidden",!1):$(e.idSelect).append('<div class="list-group list-group-flush my-n3 pt-3 '.concat(e.boxEmpty,'">\n                <div class="list-group-item">\n                    <div class="d-flex flex-row align-items-center px-md-2">\n                        <div class="col p-0 text-center"><h6 class="m-0 font-weight-semibold fs-12">No data available</h6></div>\n                    </div>\n                </div>\n            </div>'))}function x(e){var t;e.checkLoadMore=!0,t=0===e.page?e.page+1:e.page;var i=[];e.list_selected.map((function(e){i.push(e.id)})),$.ajax({url:e.urlAjax,type:"GET",data:{key:t,search:e.search,option:e.optionAjax,filter:JSON.stringify(a),selected:JSON.stringify(i)},success:function(t){e.isSearch&&$(e.idSelect).html(""),$(e.idSelect).append(t.data),e.isMoreData=t.is_more_data,!0===t.is_more_data&&(e.page=t.current_page+1),w(e),function(e,t){if(e.optionAjax===n.optionAjax){var a=[];n.list_selected.map((function(e,i){-1===t.indexOf(e.id)&&($(n.idBox).find("div[id = '".concat(e.id,"']")).remove(),a.push(i))}));for(var i=a.length-1;i>=0;i--)n.list_selected.splice(a[i],1);var o=[];$.each(n.filterAjax,(function(e,a){-1===t.indexOf(a)&&o.push(e)}));for(var s=o.length-1;s>=0;s--)n.filterAjax.splice(o[s],1);h(n)}}(e,t.list_filter),C(e),e.checkLoadMore=!1,e.lastPage=t.last_page,function(e,t,a){t<7&&1===a||(e.lastPage||t>7||0===t)&&($("."+e.boxEmpty).remove(),$(e.idSelect).append('<div class="list-group list-group-flush my-n3 pt-3 '.concat(e.boxEmpty,'">\n        <div class="list-group-item">\n            <div id="').concat(e.idEmptyLoad,'" class="d-flex flex-row align-items-center px-md-2">\n                <div class="col p-0 text-center"><h6 class="m-0 font-weight-semibold fs-12">No data available</h6></div>\n            </div>\n        </div>\n    </div>')))}(e,t.total,t.current_page)},error:function(e){console.log(e)}})}function b(e,t){$.ajax({url:"/target/filterAdTag",type:"POST",contentType:"application/json",data:JSON.stringify({type:t,tagId:e.filterAjax,serverType:parseInt($("#server_type").val())}),success:function(e){!function(e){var t;e.inventory_id.map((function(e){var a=(t=i).list_selected.map((function(e){return e.id})).indexOf(e.id);-1===a&&(t.list_selected.push({id:e.id,name:e.name}),j(e.id,e.name,t)),w(t),C(t),h(t),y(e.id,a,t)})),e.ad_format_id.map((function(e){var a=(t=o).list_selected.map((function(e){return e.id})).indexOf(e.id);-1===a&&(t.list_selected.push({id:e.id,name:e.name}),j(e.id,e.name,t)),w(t),C(t),h(t),y(e.id,a,t)})),e.ad_size_id.map((function(e){var a=(t=s).list_selected.map((function(e){return e.id})).indexOf(e.id);-1===a&&(t.list_selected.push({id:e.id,name:e.name}),j(e.id,e.name,t)),w(t),C(t),h(t),y(e.id,a,t)})),A()}(e)},error:function(e){console.log(e)}})}function y(e,t,r){switch(r.optionAjax){case i.optionAjax:-1===t&&a.inventory.push(e);break;case o.optionAjax:-1===t&&a.format.push(e);break;case s.optionAjax:-1===t&&a.size.push(e);break;case n.optionAjax:n.filterAjax.push(e),b(n,"include")}}function A(){n.page=1,n.isSearch=!0,x(n)}function k(e,t,a){var i=a.list_selected.map((function(e){return e.id})).indexOf(e);-1===i?(a.list_selected.push({id:e,name:t}),j(e,t,a)):a.list_selected.splice(i,1),C(a),h(a)}function S(e,t,a){$(a.idSelect).append('\n    <div class="dm20 target-item" id="'.concat(e,'">\n        <span>').concat(t,'</span>\n        <button class="').concat(a.btnInclude,'" data-id="').concat(e,'" name="').concat(t,'" type="button">\n            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">\n                <path d="M8 0a1 1 0 0 1 1 1v6h6a1 1 0 1 1 0 2H9v6a1 1 0 1 1-2 0V9H1a1 1 0 0 1 0-2h6V1a1 1 0 0 1 1-1z"></path>\n            </svg>\n        </button>\n    </div>'))}function j(e,t,a){$(a.idBox).append('\n        <div class="dm20 target-item item_selected" id="'.concat(e,'">\n            <span>').concat(t,'</span>\n            <button class="').concat(a.btnRemove,'" id="').concat(e,'" name="').concat(t,'" type="button">\n                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-dash-lg" viewBox="0 0 16 16">\n                    <path d="M0 8a1 1 0 0 1 1-1h14a1 1 0 1 1 0 2H1a1 1 0 0 1-1-1z"></path>\n                </svg>\n            </button>\n        </div>'))}function w(e){e.list_selected.map((function(t){$(e.idSelect).find("div[id = '".concat(t.id,"']")).remove()}))}function C(e){var t=e.list_selected.map((function(e){return" ".concat(e.name)})).join(),a=t.length;if(a>40){$(e.text).prev().attr("hidden",!0);var d=t.substring(0,39);$(e.text).html(d+"....")}else if(a>0)$(e.text).prev().attr("hidden",!0),$(e.text).html(t);else switch($(e.text).prev().removeAttr("hidden"),e){case i:$(e.text).html("all domains");break;case o:$(e.text).html("all formats");break;case s:$(e.text).html("all sizes");break;case n:$(e.text).html("all ad tags");break;case r:$(e.text).html("all geographies");break;case l:$(e.text).html("all devices")}}$(document).ready((function(){$('[data-bs-toggle="popover"]').popover({html:!0,sanitize:!1}),$(".identity-tab").on("click",".nav-link",(function(){$(".identity-tab").find(".nav-link").removeClass("pp-4"),$(this).addClass("pp-4"),"1"!=$(this).attr("data-tab")?$(this).addClass("at-1"):$(".identity-tab").find(".at-1").removeClass("at-1")})),$('[data-toggle="collapse"]').on("click",(function(){var e=$(this);e.toggleClass("dm14"),e.hasClass("dm14")?e.find(".dm23").find("button").html('<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-dash-lg" viewBox="0 0 16 16">\n<path d="M0 8a1 1 0 0 1 1-1h14a1 1 0 1 1 0 2H1a1 1 0 0 1-1-1z">\n</path>\n</svg>'):e.find(".dm23").find("button").html('<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">\n<path d="M8 0a1 1 0 0 1 1 1v6h6a1 1 0 1 1 0 2H9v6a1 1 0 1 1-2 0V9H1a1 1 0 0 1 0-2h6V1a1 1 0 0 1 1-1z"></path>\n</svg>'),$("#nav-target").find('[data-toggle="collapse"]').each((function(){e[0]!=$(this)[0]&&($(this).removeClass("dm14"),$(this).find(".dm23").find("button").html('<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">\n<path d="M8 0a1 1 0 0 1 1 1v6h6a1 1 0 1 1 0 2H9v6a1 1 0 1 1-2 0V9H1a1 1 0 0 1 0-2h6V1a1 1 0 0 1 1-1z"></path>\n</svg>'))}))})),new f("submitIdentity",v),$(".btn-collapse").click((function(e){$(this).hasClass("collapsed")?$(this).find(".text-notify-target").removeClass("d-none"):($(".text-notify-target").removeClass("d-none"),$(this).find(".text-notify-target").addClass("d-none"))})),$("#select-module").on("changed.bs.select",(function(e){if($(this).val()){var t={};t.id=$(this).val(),t.text=$("option:selected",this).text(),d.map((function(e){return e.id})).lastIndexOf(t.id)>-1||(d.push({id:t.id,index:1}),m(t.id,t.text,1)),$("#tab-module").find(".box-select-module").addClass("d-none")}})),$("#module-params").on("click","div.bidder-box .d a.rm_c",(function(){!function(e){$("#ModuleParamBox-"+e).remove();var t=[];$("#module-params").find(".module_param_box").each((function(){t.push($(this).attr("data-id"))})),$("#module").val(t),$("#module").trigger("change")}($(this).attr("data-id"))})),$("#tab-module").on("click",".add-module",(function(e){$("#tab-module").find(".box-select-module").removeClass("d-none"),p()}))})),$(document).ready((function(){var e;(function(e){e.isMoreData=$(e.idSearch).val(),e.page=1,x(e)})(e=i),h(e),function(e){$(e.idSelect).on("click","button."+e.btnInclude,(function(t){!function(e,t,a){t.preventDefault();var i=parseInt(e.data("id")),o=e.attr("name");$(a.idSelect).find("div[id = '".concat(i,"']")).remove(),k(i,o,a),y(i,-1,a),a.optionAjax!==n.optionAjax&&A()}($(this),t,e),function(e){350===$(e.idSelect).get(0).scrollHeight&&e.isMoreData&&(e.search=$(e.idSearch).val(),e.isSearch=!1,x(e))}(e),g(e),$(this).hasClass("add_inventory")&&$(".domain-card").removeClass("domain-card-invalid")})),$(e.idSearch).on("input",(function(){e.page=1,e.isSearch=!0,e.lastPage=!1,e.search=$(this).val(),x(e),_(e)})),$(e.idSearch).on("keyup keypress",(function(e){if(13===(e.keyCode||e.which))return e.preventDefault(),!1})),$(e.block).on("click","a."+e.btnRemoveAll,(function(t){t.preventDefault(),function(e){e.list_selected.map((function(t){S(t.id,t.name,e)})),e.list_selected.map((function(t){switch(e.optionAjax){case i.optionAjax:var r=a.inventory.indexOf(t.id);r>-1&&a.inventory.splice(r,1),n.page=1,n.isSearch=!0,x(n);break;case o.optionAjax:var l=a.format.indexOf(t.id);l>-1&&a.format.splice(l,1),n.page=1,n.isSearch=!0,x(n);break;case s.optionAjax:var d=a.size.indexOf(t.id);d>-1&&a.size.splice(d,1),n.page=1,n.isSearch=!0,x(n);break;case n.optionAjax:var c=n.filterAjax.indexOf(t.id);c>-1&&n.filterAjax.splice(c,1)}})),e.list_selected=[],$(e.idSelect).html(""),e.page=1,e.isSearch=!1,e.isMoreData=!0,x(e),h(e),C(e)}(e)})),$(e.idBox).on("click","button."+e.btnRemove,(function(t){!function(e,t,r){t.preventDefault();var l=parseInt(e.attr("id")),d=e.attr("name");switch(e.closest(".item_selected").remove(),S(l,d,r),k(l,d,r),r.optionAjax){case i.optionAjax:var c=a.inventory.indexOf(l);c>-1&&a.inventory.splice(c,1),n.page=1,n.isSearch=!0,x(n);break;case o.optionAjax:var m=a.format.indexOf(l);m>-1&&a.format.splice(m,1),n.page=1,n.isSearch=!0,x(n);break;case s.optionAjax:var p=a.size.indexOf(l);p>-1&&a.size.splice(p,1),n.page=1,n.isSearch=!0,x(n);break;case n.optionAjax:var u=n.filterAjax.indexOf(l);u>-1&&n.filterAjax.splice(u,1)}}($(this),t,e),g(e)}))}(e),function(e){$(e.idBox).find("."+e.btnRemove).each((function(t,a){var i=parseInt(a.id),n=a.name;e.list_selected.push({id:i,name:n})}))}(e),_(e)}))})();