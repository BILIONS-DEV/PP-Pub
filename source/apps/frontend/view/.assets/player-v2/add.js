(()=>{"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(new(function(){function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(this,a),this.isEdit=t.isEdit||!1,this.playTypeId=t.playTypeId||"#type",this.nativeAdStyleId=t.nativeAdStyleId||"#ad_style",this.videoPlayerLayoutClass=t.videoPlayerLayoutClass||"#player_layout",this.xhrMakePreview=null,this.baseUrl="/player-v2/template",this.ajaxPreview=t.ajaxPreview||this.baseUrl+"/preview",this._validFileImageExtensions=[".jpg",".jpeg",".bmp",".gif",".png"],this.maxSize=15728640,this.domainUpload="https://ul.pubpowerplatform.io",this.api_upload_image="".concat(this.domainUpload,"/api/v1/image"),this.formId="#formTemplate",this.ajxURL=t.ajxURL||"/player/template/add",this.isFirst=!!this.isEdit}var i,n,o;return i=a,n=[{key:"init",value:function(){var e=this;this.isEdit&&$(this.formId).append(Loading({topLoading:"15%"})),$(document).ready((function(){e.startEvents()}))}},{key:"startEvents",value:function(){var e=this;this.firstLoad(),this.isFirst&&(this.isFirst=!1),this.isEdit&&$(this.formId).find("._blur").remove(),this.eventClickTab(),this.eventChangePlayerType(),this.videoEvents(),this.nativeEvents(),this.eventSelectColor(),$(this.formId).on("change",(function(){e.makePreview()})),this.formEvents()}},{key:"formEvents",value:function(){var e=$(this.formId);e.find("input").on("input",(function(e){var t=$(this);t.hasClass("is-invalid")&&(t.removeClass("is-invalid").next(".invalid-feedback").empty(),t.parent().removeClass("is-invalid").next(".invalid-feedback").empty())})),e.find("textarea").on("input",(function(e){var t=$(this);t.hasClass("is-invalid")&&t.removeClass("is-invalid").next(".invalid-feedback").empty()}));var t=this;e.find(".submit").on("click",(function(a){a.preventDefault();var i=$(this),n=i.text(),o=e.serializeObject();o=t.makeData(o),$.ajax({url:t.ajxURL,type:"POST",dataType:"JSON",contentType:"application/json",data:JSON.stringify(o),beforeSend:function(e){i.attr("disabled",!0).text("Loading...")},error:function(e,t){var a=AjaxErrorMessage(e,t);new AlertError("AJAX ERROR: "+a),i.attr("disabled",!1).text(n)},success:function(e){i.attr("disabled",!1).text(n)},complete:function(e){t.added(e.responseJSON)}})}))}},{key:"added",value:function(e){switch(e.status){case"error":1===e.errors.length&&""===e.errors[0].id?new AlertError(e.errors[0].message):e.errors.length>0?($.each(e.errors,(function(e,t){var a=$("#"+t.id);a.addClass("is-invalid").nextAll("span.invalid-feedback").text(t.message),a.parent().addClass("is-invalid").nextAll("span.invalid-feedback").text(t.message)})),"floating_width_mobile"===e.errors[0].id?$(".play_mode[data-type='mobile']").click():"floating_width"===e.errors[0].id&&$(".play_mode[data-type='desktop']").click(),$("#"+e.errors[0].id).focus(),$("#"+e.errors[0].id).prev("label").focus(),new AlertError(e.errors[0].message,(function(){$("#"+e.errors[0].id).focus(),$("#"+e.errors[0].id).prev("label").focus()}))):new AlertError("Error!");break;case"success":if(this.isEdit)return void NoticeSuccess("Template has been updated successfully");NoticeSuccess("Template has been created successfully"),setTimeout((function(){window.location.replace(this.baseUrl)}),1e3);break;default:new AlertError("Undefined")}}},{key:"eventSelectColor",value:function(){var e=$(".input-color");e.on("input",(function(){$(this).next("input").val($(this).val())})),e.next("input").on("input",(function(e){$(this).prev("input").val(e.target.value)}))}},{key:"videoEvents",value:function(){this.eventChangeVideoLayout(),this.eventChangePlayerSize(),this.eventChangePlayerMode(),this.eventChangeFloat(),this.eventChangeFloat("floating_on_mobile"),this.eventChangeVideoPosition(),this.eventChangeVideoPosition("position_mobile"),this.eventChangeMainTitle(),this.eventAddLogo(),this.eventChangeAutoSkip()}},{key:"nativeEvents",value:function(){this.eventChangeNativeAdStyle(),this.eventChangeNativeOptimizeLayout(),this.eventChangeNativeMultiDimension(),this.eventChangeNativeAdSize()}},{key:"eventChangeAutoSkip",value:function(){var e=this;$("#auto_skip").change((function(){e.checkShowAdvertisement()}))}},{key:"eventAddLogo",value:function(){$(".btn-add-logo").on("click",(function(){$("#logo").click()}));var e=this;$("#logo").on("change",(function(t){e.validateAndUploadLogo($(this),e._validFileImageExtensions,t)}))}},{key:"validateAndUploadLogo",value:function(e,t,a){var i=e[0];if("file"===i.type){var n=i.value;if(n.length>0){for(var o=!1,s=0;s<t.length;s++){var l=t[s];if(n.substr(n.length-l.length,l.length).toLowerCase()===l.toLowerCase()){o=!0,this.uploadFile(a,e);break}}if(!o)return new AlertError("Sorry, "+n+" is invalid, allowed extensions are: "+t.join(", ")),!1}}return!0}},{key:"uploadFile",value:function(e,t){var a=this,i=new FormData,n=e.target.files[0];n.size>this.maxSize?new AlertError("You uploaded file over 10mb, please choose another file!"):(i.append("file",n),$.ajax({url:a.api_upload_image,type:"POST",contentType:!1,processData:!1,data:i,beforeSend:function(e){},error:function(e,t){var a=AjaxErrorMessage(e,t);new AlertError("AJAX ERROR: "+a)},success:function(e){},complete:function(e){a.afterUpload(e.responseJSON,t)}}))}},{key:"afterUpload",value:function(e,t){switch(e.status){case"error":1===e.errors.length&&""===e.errors[0].id?new AlertError(e.errors[0].message):e.errors.length>0?($.each(e.errors,(function(e,t){$("#"+t.id).addClass("is-invalid").nextAll("span.invalid-feedback").text(t.message)})),new AlertError(e.errors[0].message)):new AlertError("Error!");break;case"success":$("#preview-logo").attr("src",this.domainUpload+e.data_object.thumb[0]),$("#logo").attr("value",e.data_object.thumb[0]);break;default:new AlertError("Undefined")}}},{key:"checkDisableControls",value:function(){var e=$(".controls");this.isInstream()?(e.removeClass("disabled"),e.prop("disabled",!1),e.next().removeClass("disabled")):(e.addClass("disabled"),e.prop("disabled",!0),e.next().addClass("disabled"))}},{key:"checkDisableLogoConfig",value:function(){var e=$(".logo-config");this.isInstream()?(e.removeClass("disabled"),e.prop("disabled",!1),e.next().removeClass("disabled")):(e.addClass("disabled"),e.prop("disabled",!0),e.next().addClass("disabled"))}},{key:"checkDisableColor",value:function(){var e=$("#player_layout").val(),t=$(".box-controls-color");this.isInstream()?(t.removeClass("d-none"),(t=$("#control_color")).removeClass("disabled"),t.prop("disabled",!1),t.prev().removeClass("disabled")):t.addClass("d-none");var a=$(".box-description-color");!this.isInstream()||"3"!==e&&"4"!==e&&"5"!==e&&"7"!==e?a.addClass("d-none"):(a.removeClass("d-none"),(a=$("#description_color")).removeClass("disabled"),a.prop("disabled",!1),a.prev().removeClass("disabled"))}},{key:"eventChangeMainTitle",value:function(){var e=this;$("#show_main_title").change((function(){e.changeMainTitleAction()}))}},{key:"changeMainTitleAction",value:function(){var e=$("#show_main_title");this.isInstream()?(e.removeClass("disabled"),e.prop("disabled",!1),e.next().removeClass("disabled")):(e.addClass("disabled"),e.prop("disabled",!0),e.next().addClass("disabled"));var t=$("#main_title_text");this.isInstream()&&e.is(":checked")?(t.removeClass("disabled"),t.prop("disabled",!1),t.next().removeClass("disabled")):(t.addClass("disabled"),t.prop("disabled",!0),t.next().addClass("disabled"))}},{key:"checkDisableDisplayOption",value:function(){var e=$(this.videoPlayerLayoutClass).val();this.changeMainTitleAction();var t=$("#show_content_title");this.isInstream()?(t.removeClass("disabled"),t.prop("disabled",!1),t.next().removeClass("disabled"),$("#show-content-title").closest("div").removeClass("d-none"),t.removeClass("disabled"),t.prop("disabled",!1),t.next().removeClass("disabled")):(t.addClass("disabled"),t.prop("disabled",!0),t.next().addClass("disabled"));var a=$("#show_content_description"),i=$(".box-show-content-desc");!this.isInstream()||"3"!==e&&"4"!==e&&"5"!==e&&"7"!==e?(i.addClass("d-none"),a.addClass("disabled"),a.prop("disabled",!0),a.next().addClass("disabled")):(i.removeClass("d-none"),a.removeClass("disabled"),a.prop("disabled",!1),a.next().removeClass("disabled"));var n=$("#show_controls");this.isInstream()?(n.removeClass("disabled"),n.prop("disabled",!1),n.next().removeClass("disabled"),n.closest("div").removeClass("d-none"),n.removeClass("disabled"),n.prop("disabled",!1),n.next().removeClass("disabled")):(n.addClass("disabled"),n.prop("disabled",!0),n.next().addClass("disabled"))}},{key:"changeVideoPositionAction",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"position_desktop",a=$("#".concat(t)).val(),i=$(".".concat(t));switch(i.addClass("d-none"),a){case"1":e=$(".".concat(t,"_bottom_right"));break;case"2":e=$(".".concat(t,"_bottom_left"));break;case"3":e=$(".".concat(t,"_top_right"));break;case"4":e=$(".".concat(t,"_top_left"))}e.removeClass("d-none")}},{key:"eventChangeVideoPosition",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"position_desktop";$("#".concat(t)).on("change",(function(){e.changeVideoPositionAction(t)}))}},{key:"resizePreviewNative",value:function(){try{var e=document.getElementById("resizeWrapper");if(!e)return;var t=0,a=0,i=this,n=function(n){var o=n.clientX-t;e.style.width=a+o+"px",i.setPreviewSize()},o=function e(){document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",e)};document.querySelector(".resizer").addEventListener("mousedown",(function(i){t=i.clientX;var s=window.getComputedStyle(e);a=parseInt(s.width,10),document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)}))}catch(e){}this.setPreviewSize()}},{key:"setPreviewSize",value:function(){$("#preview_size").hasClass("d-none")||document.querySelector("#adsPlacement")&&setTimeout((function(){var e=document.querySelector("#adsPlacement").offsetWidth,t=document.querySelector("#adsPlacement").offsetHeight;document.getElementById("p_height").innerHTML=t,document.getElementById("p_width").innerHTML=e}),50)}},{key:"eventChangeWidth",value:function(){var e=this;$("#width").change((function(){e.makePreview()}))}},{key:"eventChangeFloat",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"floating_on_desktop";$("#"+t).change((function(){e.changeFloatAction(t)}))}},{key:"changeFloatAction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"floating_on_desktop",t=$("#"+e).is(":checked"),a=$("."+e);t?(a.removeClass("disabled"),a.prop("disabled",!1),a.next().removeClass("disabled")):(a.addClass("disabled"),a.prop("disabled",!0),a.next().addClass("disabled"))}},{key:"firstLoad",value:function(){this.changePlayerSizeAction(),this.changeVideoPositionAction(),this.changeVideoPositionAction("position_mobile"),this.checkDisableDisplayOption(),this.checkDisableColor(),this.checkDisableControls(),this.checkDisableLogoConfig(),this.checkShowColumnsNumber(),this.checkShowColumnsPosition(),this.checkShowAdvertisement(),this.changeFloatAction(),this.changeFloatAction("floating_on_mobile"),this.checkValueimpressionLogo(),this.changeNativeAdStyleAction(),this.changePlayerTypeAction()}},{key:"checkValueimpressionLogo",value:function(){this.isInstream()?$("#pubpower_logo").closest("div").removeClass("d-none"):$("#pubpower_logo").closest("div").addClass("d-none")}},{key:"checkShowAdvertisement",value:function(){var e=$("#auto_skip").is(":checked"),t=$(".box-auto-skip"),a=$(".box-time-to-skip"),i=$(".box-show-auto-skips-button"),n=$(".box-number-of-pre-roll"),o=$(".box-delay");this.isInstream()?(t.removeClass("d-none"),e?(a.removeClass("d-none"),i.removeClass("d-none"),n.removeClass("d-none"),o.addClass("d-none")):(a.addClass("d-none"),i.addClass("d-none"),n.addClass("d-none"),o.removeClass("d-none"))):(t.addClass("d-none"),a.addClass("d-none"),i.addClass("d-none"),n.addClass("d-none"),o.removeClass("d-none"))}},{key:"checkShowColumnsPosition",value:function(){var e=$("#player_layout").val(),t=$(".box-columns-position"),a=$("#columns_position_right");if(!this.isInstream()||"6"!==e&&"7"!==e)t.addClass("d-none");else{if(t.removeClass("d-none"),this.isEdit&&this.isFirst)return;a.prop("checked",!0)}}},{key:"checkShowColumnsNumber",value:function(){var e=$("#player_layout").val(),t=$(".box-columns-number"),a=$("#columns_number_two");if(this.isInstream()&&"6"===e){if(t.removeClass("d-none"),this.isEdit&&this.isFirst)return;a.prop("checked",!0)}else t.addClass("d-none")}},{key:"eventChangePlayerMode",value:function(){$(".play_mode").on("click",(function(){$(".play_mode").removeClass("pt52"),$(".box-play-mode").addClass("d-none"),$(this).addClass("pt52"),$(".box-"+$(this).data("type")).removeClass("d-none")}))}},{key:"eventClickTab",value:function(){$(".template-tab").on("click",".nav-link",(function(){$(".template-tab").find(".nav-link").removeClass("pp-4 at-1"),$(this).addClass("pp-4"),"1"!==$(this).attr("data-tab")&&$(this).addClass("at-1")}))}},{key:"eventChangeVideoLayout",value:function(){var e=this;$(".slide").on("click",(function(){switch($(".slide").removeClass("selected"),$(this).addClass("selected"),$(e.videoPlayerLayoutClass).val($(this).data("value")),!0){case e.isOutstream():$("#tab-customize").addClass("d-none"),$(".no-preview-available").removeClass("d-none"),$("#videocontainer").empty(),e.resizePreviewNative();break;case e.isInstream():$(".no-preview-available").addClass("d-none"),$("#tab-customize").removeClass("d-none")}e.firstLoad()}))}},{key:"isOutstream",value:function(){return"9"===$(this.playTypeId).val()&&"9"===$(this.videoPlayerLayoutClass).val()}},{key:"isInstream",value:function(){return"9"===$(this.playTypeId).val()&&["1","2","3","4","5","6","7","8"].includes($(this.videoPlayerLayoutClass).val())}},{key:"eventChangePlayerType",value:function(){var e=this;$(this.playTypeId).on("change",(function(){e.changePlayerTypeAction()}))}},{key:"eventChangePlayerSize",value:function(){var e=this;$("input[type=radio][name=size]").change((function(){e.changePlayerSizeAction()}))}},{key:"changePlayerSizeAction",value:function(){var e=$("input[type=radio][name=size]:checked").val(),t=$(".box-width"),a=$(".box-ratio");switch(e){case"1":t.addClass("d-none"),a.removeClass("d-none");break;case"2":a.addClass("d-none"),t.removeClass("d-none")}}},{key:"eventChangeNativeAdStyle",value:function(){var e=this;$(this.nativeAdStyleId).change((function(){e.changeNativeAdStyleAction(),e.updateNativePreview()}))}},{key:"eventChangeNativeOptimizeLayout",value:function(){var e=this;$("input[name=mode]").change((function(){e.changeNativeOptimizeLayoutAction(),e.updateNativePreview()}))}},{key:"eventChangeNativeMultiDimension",value:function(){var e=this;$(".multi-row-input,.multi-column-input").change((function(){e.updateNativePreview()}))}},{key:"eventChangeNativeAdSize",value:function(){var e=this;$("#ad-size").change((function(){e.updateNativePreview()}))}},{key:"changeNativeOptimizeLayoutAction",value:function(){switch($("input[name=mode]:checked").val()){case"auto":$(".box-optimize-layout").addClass("d-none");break;case"fixed":$(".box-optimize-layout").removeClass("d-none")}}},{key:"changeNativeAdStyleAction",value:function(){switch(!0){case this.isMultiplexAdNative():this.showMultiplexAdNative();break;case this.isSingleAdNative():this.showSingleAdNative()}}},{key:"isMultiplexAdNative",value:function(){return"multiple"===$(this.nativeAdStyleId).val()}},{key:"isSingleAdNative",value:function(){return"single"===$(this.nativeAdStyleId).val()}},{key:"updateNativePreview",value:function(){console.log("updateNativePreview"),$(".adsbypocpoc").remove(),$("#adsPlacement").append('<div class="adsbypocpoc" data-ad-slot="preview"></div>');var e=$("#native_background").val(),t=$("#native_advertiser_name").val(),a=$("#native_cta_button").val(),i=$("#native_title_color").val(),n=parseInt($(".multi-column-input").val()),o=parseInt($(".multi-row-input").val()),s=$("#ad-size").find("option:selected").text(),l=$('input[name="mode"]:checked').val(),r=$("#ad_style").val(),d="grid";switch(!0){case this.isMultiplexAdNative():s="1x1",d="grid";break;case this.isSingleAdNative():n=1,o=1,d="standard"}try{(ppocTag.Init=window.ppocTag.Init||[]).push((function(){ppocAPITag.previewTemplate({configs:{appearance:{background:e,colorAdvertiser:t,colorButtonCTA:a,colorHeadline:i,sponsoredBrand:!1},layout:{template:d,columns:n,rows:o,size:s},mode:l,type:r}})}))}catch(e){console.error(e)}console.log({appearance:{background:e,colorAdvertiser:t,colorButtonCTA:a,colorHeadline:i,sponsoredBrand:!1},layout:{template:d,columns:n,rows:o,size:s},mode:l,type:r}),this.setPreviewSize()}},{key:"showMultiplexAdNative",value:function(){$(".box-style-multiple").removeClass("d-none"),$(".box-style-single").addClass("d-none"),$("#preview_size").removeClass("d-none")}},{key:"showSingleAdNative",value:function(){$(".box-style-multiple").addClass("d-none"),$(".box-style-single").removeClass("d-none"),$("#preview_size").addClass("d-none")}},{key:"changePlayerTypeAction",value:function(){switch(!0){case this.isNative():this.showNativeOptions();break;case this.isVideo():this.showVideoOptions()}this.makePreview()}},{key:"isNative",value:function(){return"8"===$(this.playTypeId).val()}},{key:"isVideo",value:function(){return"9"===$(this.playTypeId).val()}},{key:"showNativeOptions",value:function(){$("#tab-customize").removeClass("d-none"),$(".no-preview-available").addClass("d-none"),$(".video-template-element").addClass("d-none"),$(".native-template-element").removeClass("d-none")}},{key:"showVideoOptions",value:function(){this.isOutstream()&&($("#tab-customize").addClass("d-none"),$(".no-preview-available").removeClass("d-none")),$(".video-template-element").removeClass("d-none"),$(".native-template-element").addClass("d-none")}},{key:"abortXhrMakePreview",value:function(){this.xhrMakePreview&&4!==this.xhrMakePreview.readyState&&this.xhrMakePreview.abort()}},{key:"makePreview",value:function(){var e=this;switch(this.resizePreviewNative(),!0){case"8"===$(this.playTypeId).val():this.updateNativePreview();break;case this.isInstream():this.abortXhrMakePreview();var t=$(this.formId).serializeObject();t=this.makeData(t),this.xhrMakePreview=$.ajax({url:this.ajaxPreview,type:"POST",dataType:"JSON",contentType:"application/json",data:JSON.stringify(t),success:function(t){$("#videocontainer").empty(),e.callVideo(t)}})}}},{key:"callVideo",value:function(e){var t=this,a=0,i=setInterval((function(){a>10&&(clearInterval(i),console.error("Can not init power video container")),"undefined"==typeof viAPItag?a++:(clearInterval(i),viAPItag.initPowerVideoContainer(e),t.setPreviewSize())}),100)}},{key:"makeData",value:function(e){return this.isEdit&&e.id&&(e.id=parseInt(e.id)),e.type=parseInt(e.type),e.vast_retry=parseInt(e.vast_retry),e.delay=parseInt(e.delay),e.time_to_skip=parseInt(e.time_to_skip),e.max_width=parseInt(e.max_width),e.width=parseInt(e.width),e.floating_width=parseInt(e.floating_width),e.floating_width_mobile=parseInt(e.floating_width_mobile),e.margin_bottom_desktop=parseInt(e.margin_bottom_desktop),e.margin_bottom_mobile=parseInt(e.margin_bottom_mobile),e.margin_left_desktop=parseInt(e.margin_left_desktop),e.margin_left_mobile=parseInt(e.margin_left_mobile),e.margin_right_desktop=parseInt(e.margin_right_desktop),e.margin_right_mobile=parseInt(e.margin_right_mobile),e.margin_top_desktop=parseInt(e.margin_top_desktop),e.columns_position=parseInt(e.columns_position),e.columns_number=parseInt(e.columns_number),e.player_layout=parseInt(e.player_layout),e.show_auto_skip_button=parseInt(e.show_auto_skip_button),e.number_of_pre_roll_ads=parseInt(e.number_of_pre_roll_ads),e.floating_position_desktop=parseInt(e.floating_position_desktop),e.floating_position_mobile=parseInt(e.floating_position_mobile),e.play_mode=parseInt(e.play_mode),e.advertisement_scenario=parseInt(e.advertisement_scenario),e.size=parseInt(e.size),e.auto_start=parseInt(e.auto_start),e.link=$("#preview-logo").attr("src"),["close_floating_button_mobile","close_floating_button_desktop","main_title","default_sound_mode","description_enable","show_controls","floating_on_desktop","floating_on_mobile","sub_title","action_button","title_enable","pubpower_logo","powered_by","powered_by_top_article","share_button","video_config","show_stats","fullscreen_button","next_prev_arrows_button","next_prev_time","enable_logo","auto_skip","float_on_bottom","floating_on_view","float_on_bottom_mobile","floating_on_view_mobile","floating_on_impression","floating_on_ad_fetched","floating_on_ad_fetched_mobile","wait_for_ad","pre_roll","mid_roll","post_roll"].forEach((function(t){"on"===e[t]?e[t]=1:e[t]=2})),e.custom_logo_top_article=1,e.custom_logo=1,e.enable_logo_top_article=e.enable_logo,("8"==e.type||8==e.type||this.isEdit&&"8"===$(this.playTypeId).attr("data-type"))&&(e.title_color=$("#native_title_color").val(),e.background_color=$("#native_background").val(),e.action_button_color=$("#native_cta_button").val(),e.advertiser_color=$("#native_advertiser_name").val()),e.ad_size=parseInt(e.ad_size),e.rows=parseInt(e.rows),e.columns=parseInt(e.columns),e}}],n&&t(i.prototype,n),o&&t(i,o),a}())).init(),$(document).ready((function(){$('[data-bs-toggle="popover"]').popover({html:!0,sanitize:!1})}))})();